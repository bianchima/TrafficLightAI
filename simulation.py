import time
import random
import argparse

import map
import parser
from simulation_graphics import SimulationWindow
from util import Card
import util
from inpututil import *

################################################################
########################### Simulation #########################
################################################################

# TODO: All of the time step and execution code

# p = parser.parse("samplelayout.json")
# t = parser.Traffic("sampletraffic.json", "samplelayout.json")
# f = parser.Flow(p)
#
# light_min_time = 5

class Simulation :

    def __init__(self, traffic_pattern, graphics=False):
        # TODO:
        # store the traffic pattern
        # traffic_pattern structure: dictionary with keys as the intersection [x_road, y_road]
        # and value of a list of integers representing the index of the traffic pattern
        # in util.intersection_states at that time step
        # in order intersections are created in map.py

        # parse the files
        # create a map
        random.seed("anything")

        self.current_time = 0

        self.waiting_steps = 0

        self.map = map.Map(t, f)
        self.traffic_pattern = traffic_pattern
        self.intersections = self.map.get_intersections()
        if graphics :
            self.simulationWindow = SimulationWindow(self.map, self)
        else :
            self.simulationWindow = None


    def stepTime(self):
        # step forward in time
        x = self.current_time % light_min_time
        y = int(self.current_time / light_min_time)
        if x == 0:
            for i in self.intersections:
                lightPattern = self.traffic_pattern[i.get_global_location()]
                if y < len(lightPattern) :
                    i.set_state(lightPattern[y])
                else :
                    # TODO : What to do at end of simulation
                    return False # No time stepped


        # move cars
        x_roads = self.map.x_roads
        y_roads = self.map.y_roads
        roads = [x_roads[k] for k in x_roads] + [y_roads[k] for k in y_roads]
        all_cars = set()
        moved_cars = set()
        for i in range(len(self.intersections)) :
            for roadPair in roads : # roadPairs is a tuple of two road
                for road in roadPair :
                    array = road.road
                    iterable = reversed(range(len(array)))
                    for pos in iterable :
                        car = array[pos]
                        if type(car) == map.Car and car not in moved_cars:
                            all_cars.add(car)
                            moved, waiting = road.advance_car(pos, i == len(self.intersections) - 1)
                            if moved :
                                moved_cars.add(car)
                            self.waiting_steps += waiting

        for roadPair in roads : # roadPairs is a tuple of two road
            for road in roadPair :
                road.spawner.time_step(self.current_time)

        self.current_time += 1

        if self.simulationWindow is not None :
            car_info = []
            for car in all_cars :
                roadNum = car.road.global_loc * self.map.get_block_size()
                roadDir = car.road.card
                location = car.road_index
                color = car.color
                car_info.append((roadNum, roadDir, location, color))
            self.simulationWindow.undrawCars()
            self.simulationWindow.drawCars(car_info)
            self.simulationWindow.update()

        # TODO:
        #  what algorithm are we using? Cars might be stuck, easier to debug with
        # graphics

        return True # sucess

    def get_results(self):
        on_road_time = 0
        x_roads = self.map.x_roads
        y_roads = self.map.y_roads
        roads = [x_roads[k] for k in x_roads] + [y_roads[k] for k in y_roads]

        for roadPair in roads :
            for road in roadPair :
                for i in road.road:
                    if type(i) is map.Car:
                         on_road_time += i.waiting_steps
                for car in road.spawner.queue:
                    on_road_time += car.waiting_steps

        return self.waiting_steps + on_road_time

    def run(self):
        while self.stepTime() :
            pass


if __name__ == "__main__":
    setup = 0

    ap = argparse.ArgumentParser(description="setup number")
    ap.add_argument('-s', dest="setup", type=int, choices=[0,1,2], default=0)

    args = ap.parse_args()
    setup = args.setup

    # Run on sample
    if setup == 0:
        p = parser.parse("samplelayout.json")
        t = parser.Traffic("sampletraffic.json", "samplelayout.json")

        # 30545
        pattern = {(1, 1): [13, 9, 6, 8, 0, 12, 7, 13, 0, 1, 7, 14, 4, 13, 6, 4, 11, 10, 10, 14, 14, 10, 3, 1, 1, 3, 13, 4, 5, 7, 13, 13, 7, 8, 7, 14, 12, 11, 9, 14, 8, 15, 12, 5, 6, 12, 0, 15, 15, 11, 4, 3, 12, 13, 10, 9, 3, 10, 13, 16, 16, 7, 4, 7, 14, 5, 11, 11, 12, 7, 6, 1, 5, 7, 6, 8, 13, 1, 11, 11], (1, 2): [0, 9, 8, 2, 3, 16, 7, 5, 6, 9, 1, 1, 7, 8, 13, 7, 10, 8, 9, 15, 13, 0, 6, 6, 8, 6, 3, 14, 4, 0, 10, 3, 11, 13, 8, 2, 7, 2, 4, 14, 14, 0, 11, 13, 15, 2, 14, 6, 6, 7, 14, 9, 3, 1, 13, 4, 2, 0, 11, 10, 11, 5, 3, 12, 7, 4, 14, 0, 5, 13, 12, 2, 3, 7, 10, 0, 16, 1, 12, 8], (3, 1): [0, 0, 6, 13, 9, 13, 10, 7, 9, 2, 0, 14, 13, 2, 3, 12, 6, 15, 9, 2, 2, 9, 13, 0, 1, 6, 3, 7, 15, 16, 0, 6, 10, 14, 14, 16, 11, 0, 4, 10, 12, 13, 14, 15, 15, 2, 5, 2, 4, 2, 16, 0, 16, 14, 12, 16, 10, 13, 4, 3, 4, 10, 10, 5, 8, 2, 8, 15, 3, 9, 11, 14, 11, 3, 7, 11, 12, 5, 6, 1], (3, 2): [10, 13, 6, 14, 4, 3, 5, 12, 7, 10, 14, 10, 14, 16, 15, 5, 15, 16, 14, 16, 16, 14, 11, 5, 5, 2, 13, 6, 11, 1, 4, 0, 7, 13, 15, 6, 13, 5, 4, 0, 7, 10, 6, 10, 3, 13, 11, 3, 3, 13, 7, 8, 8, 3, 10, 2, 9, 13, 6, 0, 0, 11, 3, 6, 9, 11, 1, 10, 9, 0, 10, 16, 3, 11, 8, 6, 10, 2, 12, 9]}

        # 22838
        pattern2 = {(1, 1): [4, 10, 8, 3, 0, 16, 16, 0, 2, 16, 4, 15, 5, 7, 9, 0, 11, 15, 3, 7, 1, 10, 12, 15, 3, 10, 15, 7, 2, 16, 11, 0, 5, 16, 8, 2, 3, 15, 16, 16, 2, 0, 15, 7, 7, 16, 9, 4, 5, 3, 2, 11, 9, 15, 4, 10, 8, 1, 15, 13, 16, 6, 1, 6, 10, 16, 10, 15, 15, 11, 15, 15, 3, 11, 3, 10, 8, 0, 10, 1], (1, 2): [9, 9, 12, 2, 10, 2, 4, 16, 13, 3, 15, 13, 14, 1, 2, 2, 8, 3, 15, 12, 8, 5, 6, 4, 5, 7, 6, 4, 16, 8, 0, 2, 6, 2, 0, 12, 16, 10, 6, 1, 13, 7, 6, 13, 5, 6, 3, 9, 12, 2, 16, 16, 7, 10, 3, 0, 9, 1, 10, 6, 14, 2, 5, 10, 6, 2, 2, 1, 14, 4, 7, 4, 5, 16, 6, 13, 12, 5, 0, 8], (3, 1): [9, 9, 7, 14, 8, 15, 9, 16, 1, 16, 3, 7, 2, 4, 14, 1, 13, 5, 4, 13, 2, 6, 12, 12, 12, 7, 7, 9, 15, 15, 4, 15, 6, 14, 12, 9, 16, 4, 1, 2, 16, 2, 5, 6, 6, 5, 13, 12, 4, 3, 3, 9, 5, 11, 13, 9, 14, 13, 7, 4, 15, 9, 3, 14, 6, 12, 16, 1, 9, 11, 16, 10, 7, 10, 5, 6, 10, 4, 2, 7], (3, 2): [1, 13, 12, 5, 5, 9, 16, 16, 4, 12, 4, 15, 4, 0, 13, 4, 2, 9, 10, 5, 3, 15, 9, 16, 10, 14, 6, 7, 16, 15, 7, 2, 9, 2, 5, 4, 0, 7, 13, 9, 2, 15, 11, 6, 5, 9, 10, 13, 16, 2, 1, 4, 14, 11, 14, 7, 3, 0, 9, 13, 12, 13, 10, 14, 6, 6, 13, 14, 7, 7, 8, 10, 0, 2, 15, 6, 11, 8, 15, 4]}


    # Run on bianchi
    elif setup == 1:
        p = parser.parse("bianchilayout.json")
        t = parser.Traffic("bianchitraffic.json", "bianchilayout.json")

        # 31308
        pattern = {(1, 1): [11, 3, 5, 9, 8, 7, 9, 1, 6, 7, 14, 6, 2, 1, 15, 0, 15, 6, 8, 1, 10, 10, 16, 15, 11, 15, 10, 12, 4, 13, 16, 7, 10, 6, 1, 8, 0, 6, 3, 9, 8, 9, 9, 16, 6, 5, 12, 10, 16, 0, 3, 0, 7, 11, 5, 13, 5, 8, 4, 12, 6, 8, 7, 3, 5, 13, 0, 5, 6, 9, 15, 1, 7, 10, 1, 14, 7, 4, 14, 4, 5, 7, 0, 0, 13, 0, 15, 1, 6, 2, 12, 16, 3, 2, 6, 13, 14, 0, 10, 9, 6, 4, 0, 10, 6, 10, 3, 4, 12, 8, 9, 11, 5, 7, 0, 4, 7, 5, 5, 11], (1, 2): [14, 11, 0, 9, 3, 11, 12, 7, 0, 14, 12, 14, 5, 9, 11, 6, 10, 2, 6, 4, 7, 6, 16, 16, 13, 4, 8, 13, 4, 0, 2, 13, 6, 2, 16, 8, 16, 14, 5, 8, 13, 1, 4, 14, 5, 5, 8, 0, 15, 3, 8, 12, 5, 13, 13, 16, 2, 10, 10, 1, 14, 9, 0, 12, 2, 2, 4, 5, 10, 3, 6, 13, 15, 0, 0, 7, 5, 1, 3, 9, 10, 4, 13, 15, 15, 10, 0, 8, 4, 7, 6, 3, 13, 1, 11, 4, 2, 7, 9, 2, 10, 14, 8, 15, 5, 15, 1, 13, 13, 13, 16, 7, 15, 3, 8, 13, 0, 13, 1, 3], (1, 5): [9, 16, 9, 11, 8, 15, 11, 5, 6, 14, 13, 14, 5, 12, 10, 9, 13, 9, 15, 3, 11, 3, 12, 11, 8, 0, 11, 11, 16, 3, 0, 6, 7, 13, 8, 4, 6, 7, 4, 5, 2, 3, 0, 2, 10, 13, 4, 9, 11, 9, 16, 10, 12, 14, 15, 5, 10, 4, 11, 9, 0, 0, 5, 0, 3, 15, 4, 3, 9, 15, 13, 15, 7, 9, 10, 2, 3, 1, 7, 0, 11, 3, 9, 8, 2, 13, 5, 6, 2, 14, 11, 14, 14, 12, 10, 16, 5, 0, 5, 12, 14, 10, 13, 4, 11, 10, 0, 5, 15, 1, 6, 11, 10, 1, 10, 15, 2, 12, 10, 1], (3, 1): [10, 9, 15, 3, 16, 7, 14, 8, 8, 10, 11, 5, 15, 5, 8, 1, 4, 4, 10, 11, 11, 4, 4, 16, 3, 2, 5, 6, 9, 6, 4, 2, 9, 6, 8, 14, 11, 6, 2, 11, 15, 7, 1, 13, 10, 8, 7, 8, 10, 2, 11, 7, 12, 4, 10, 2, 10, 13, 15, 3, 4, 14, 6, 4, 15, 7, 7, 5, 14, 10, 13, 12, 15, 13, 16, 3, 11, 15, 15, 15, 11, 1, 11, 7, 8, 2, 3, 9, 13, 8, 2, 6, 7, 14, 3, 0, 13, 9, 6, 5, 12, 10, 1, 12, 9, 16, 2, 13, 7, 2, 15, 13, 8, 0, 16, 8, 12, 2, 6, 2], (3, 2): [8, 12, 14, 2, 16, 7, 8, 6, 10, 14, 11, 3, 9, 4, 11, 15, 6, 8, 14, 11, 16, 3, 2, 11, 0, 13, 10, 11, 3, 8, 11, 4, 2, 12, 11, 3, 12, 10, 7, 4, 4, 1, 3, 12, 14, 3, 4, 3, 10, 2, 2, 15, 13, 0, 7, 5, 12, 8, 1, 14, 6, 8, 14, 3, 4, 16, 0, 8, 9, 8, 11, 3, 15, 14, 0, 14, 11, 13, 14, 12, 6, 3, 15, 2, 1, 9, 1, 15, 16, 8, 3, 6, 11, 2, 2, 3, 12, 7, 4, 1, 2, 1, 3, 1, 4, 1, 11, 6, 8, 12, 12, 2, 9, 12, 3, 12, 9, 8, 6, 13], (3, 5): [15, 11, 5, 12, 15, 16, 1, 4, 16, 13, 11, 6, 11, 9, 11, 7, 12, 0, 9, 5, 4, 10, 3, 3, 4, 3, 9, 10, 4, 11, 3, 12, 8, 1, 0, 7, 15, 13, 9, 16, 4, 13, 13, 5, 1, 2, 7, 2, 16, 13, 9, 6, 0, 13, 1, 8, 4, 8, 10, 6, 12, 14, 5, 2, 1, 8, 11, 11, 9, 12, 10, 0, 2, 10, 3, 14, 7, 12, 9, 16, 6, 4, 11, 8, 14, 9, 9, 2, 9, 5, 7, 9, 1, 16, 0, 14, 8, 13, 9, 12, 2, 14, 8, 10, 13, 8, 0, 5, 10, 0, 7, 16, 9, 5, 0, 15, 10, 14, 6, 7], (4, 1): [7, 15, 7, 10, 3, 2, 1, 1, 13, 3, 12, 16, 0, 10, 2, 16, 4, 13, 12, 0, 5, 6, 16, 9, 12, 10, 14, 16, 12, 9, 4, 7, 10, 9, 7, 15, 2, 13, 10, 10, 8, 4, 10, 5, 5, 5, 6, 6, 5, 13, 3, 8, 15, 8, 16, 6, 9, 10, 12, 4, 15, 0, 11, 7, 12, 6, 3, 11, 8, 10, 3, 2, 7, 14, 14, 2, 6, 10, 16, 12, 1, 4, 10, 4, 2, 9, 7, 12, 5, 10, 6, 16, 16, 12, 3, 3, 2, 15, 13, 4, 12, 9, 10, 8, 12, 5, 8, 5, 13, 9, 11, 2, 11, 12, 5, 16, 7, 13, 7, 3], (4, 2): [13, 10, 15, 16, 0, 5, 7, 11, 6, 16, 9, 3, 12, 11, 12, 2, 11, 1, 15, 3, 13, 15, 16, 1, 6, 12, 3, 6, 1, 4, 15, 3, 4, 7, 3, 16, 4, 13, 4, 0, 2, 1, 16, 7, 11, 9, 7, 4, 15, 1, 5, 13, 5, 12, 12, 8, 5, 8, 12, 10, 15, 13, 11, 2, 3, 7, 13, 16, 0, 16, 5, 5, 6, 9, 5, 10, 16, 10, 1, 9, 5, 5, 12, 16, 14, 10, 3, 14, 15, 3, 9, 6, 16, 3, 0, 5, 5, 16, 8, 12, 15, 1, 14, 14, 16, 8, 16, 5, 5, 9, 1, 12, 2, 4, 12, 5, 11, 11, 2, 6], (4, 5): [3, 8, 10, 11, 10, 9, 1, 7, 3, 0, 6, 11, 10, 16, 2, 0, 2, 1, 2, 2, 8, 14, 3, 11, 16, 14, 11, 15, 12, 3, 5, 15, 0, 2, 9, 1, 4, 12, 14, 3, 10, 7, 12, 15, 6, 4, 2, 1, 11, 4, 8, 13, 12, 5, 13, 5, 9, 7, 16, 12, 14, 14, 2, 8, 2, 7, 12, 1, 13, 16, 3, 4, 14, 5, 8, 3, 16, 2, 0, 16, 13, 9, 7, 5, 15, 7, 14, 12, 8, 2, 3, 13, 4, 15, 12, 5, 12, 10, 13, 7, 15, 12, 3, 2, 4, 10, 15, 3, 9, 12, 16, 12, 8, 1, 1, 2, 1, 5, 5, 9]}

        # 26352
        pattern2 = {(1, 1): [11, 3, 5, 9, 8, 7, 9, 1, 6, 7, 14, 6, 0, 1, 15, 0, 15, 6, 8, 1, 10, 10, 5, 15, 11, 15, 10, 12, 4, 4, 8, 7, 10, 6, 1, 16, 0, 6, 3, 9, 10, 13, 9, 16, 6, 5, 12, 10, 11, 0, 3, 8, 7, 3, 6, 13, 5, 14, 4, 12, 6, 10, 7, 3, 5, 13, 0, 5, 6, 9, 11, 14, 7, 12, 1, 6, 7, 4, 14, 13, 5, 16, 13, 0, 15, 0, 15, 1, 6, 2, 1, 16, 3, 2, 6, 13, 10, 0, 12, 9, 6, 4, 16, 10, 6, 7, 3, 4, 12, 8, 8, 11, 13, 7, 0, 4, 7, 5, 1, 11], (1, 2): [12, 11, 0, 9, 7, 11, 14, 7, 0, 14, 12, 14, 5, 9, 11, 6, 10, 16, 6, 4, 7, 6, 16, 1, 9, 4, 8, 13, 4, 0, 2, 13, 6, 0, 16, 10, 16, 14, 14, 8, 13, 1, 8, 1, 5, 7, 12, 0, 15, 3, 8, 12, 5, 13, 12, 16, 2, 12, 10, 1, 14, 7, 0, 12, 2, 6, 4, 5, 10, 3, 6, 13, 15, 0, 0, 11, 5, 2, 3, 9, 10, 4, 13, 15, 15, 10, 0, 8, 4, 5, 7, 3, 13, 1, 11, 6, 0, 6, 9, 2, 10, 7, 8, 15, 5, 15, 1, 13, 0, 9, 0, 9, 15, 11, 8, 13, 0, 13, 16, 3], (1, 5): [9, 16, 9, 11, 8, 15, 11, 7, 6, 14, 13, 10, 7, 12, 10, 9, 13, 9, 15, 3, 13, 3, 12, 2, 6, 0, 11, 11, 16, 3, 0, 8, 7, 13, 8, 4, 6, 6, 4, 5, 2, 5, 7, 2, 10, 13, 4, 9, 11, 9, 16, 10, 12, 14, 0, 5, 10, 4, 11, 9, 0, 0, 7, 0, 3, 15, 12, 3, 9, 16, 13, 15, 7, 9, 10, 2, 3, 10, 7, 10, 11, 3, 9, 8, 2, 13, 5, 6, 1, 16, 11, 6, 14, 12, 10, 16, 14, 0, 5, 12, 14, 10, 13, 4, 11, 10, 0, 14, 15, 1, 6, 11, 10, 14, 10, 15, 2, 12, 13, 1], (3, 1): [10, 9, 15, 16, 7, 7, 14, 0, 8, 10, 11, 5, 15, 5, 8, 1, 6, 8, 10, 11, 1, 4, 4, 13, 3, 2, 5, 6, 5, 6, 4, 2, 10, 6, 8, 14, 13, 6, 2, 11, 15, 7, 0, 13, 6, 8, 7, 8, 10, 2, 11, 7, 16, 4, 10, 11, 10, 13, 7, 3, 2, 16, 6, 5, 2, 7, 7, 5, 10, 10, 0, 12, 15, 13, 12, 3, 9, 15, 15, 15, 11, 1, 13, 11, 8, 2, 3, 9, 13, 6, 6, 2, 7, 14, 4, 0, 13, 9, 6, 14, 12, 10, 1, 12, 11, 14, 2, 13, 7, 2, 15, 4, 8, 0, 16, 8, 12, 1, 4, 2], (3, 2): [8, 12, 14, 15, 12, 7, 6, 6, 10, 14, 11, 3, 5, 4, 15, 15, 6, 8, 14, 11, 16, 2, 2, 15, 0, 13, 9, 2, 11, 8, 6, 13, 2, 12, 7, 7, 3, 10, 7, 3, 4, 1, 2, 12, 14, 14, 4, 3, 10, 0, 2, 15, 13, 0, 7, 5, 3, 4, 1, 14, 15, 9, 14, 3, 4, 16, 0, 8, 9, 9, 11, 3, 15, 14, 4, 14, 11, 13, 14, 12, 6, 16, 15, 2, 1, 9, 1, 15, 16, 8, 6, 4, 11, 2, 2, 3, 12, 7, 5, 5, 7, 1, 16, 1, 11, 1, 11, 6, 8, 12, 12, 2, 9, 12, 10, 11, 9, 8, 6, 13], (3, 5): [15, 11, 5, 12, 15, 16, 1, 2, 16, 13, 11, 6, 7, 9, 2, 7, 12, 0, 7, 1, 4, 1, 3, 3, 4, 3, 9, 10, 4, 11, 5, 12, 8, 0, 0, 7, 15, 13, 9, 3, 4, 15, 13, 5, 1, 2, 7, 2, 16, 13, 0, 6, 0, 12, 1, 8, 4, 8, 11, 5, 4, 14, 5, 2, 1, 8, 11, 11, 9, 12, 10, 0, 2, 10, 3, 14, 7, 3, 9, 1, 6, 4, 11, 8, 6, 1, 9, 6, 9, 3, 7, 10, 0, 16, 0, 13, 8, 13, 8, 12, 6, 14, 9, 10, 5, 6, 0, 5, 4, 0, 7, 14, 5, 5, 0, 15, 2, 14, 6, 8], (4, 1): [7, 6, 7, 2, 3, 2, 1, 1, 11, 3, 3, 1, 0, 10, 10, 14, 4, 13, 12, 0, 5, 10, 16, 9, 10, 6, 14, 8, 12, 9, 4, 7, 10, 9, 7, 15, 0, 13, 9, 12, 8, 4, 10, 5, 5, 5, 6, 6, 5, 13, 3, 4, 15, 8, 16, 15, 9, 11, 12, 4, 15, 0, 16, 7, 10, 6, 3, 11, 8, 5, 3, 2, 7, 14, 14, 2, 6, 6, 16, 12, 5, 4, 10, 4, 11, 9, 7, 12, 5, 2, 6, 3, 14, 12, 3, 3, 2, 15, 13, 4, 12, 9, 10, 8, 16, 3, 8, 11, 13, 9, 13, 2, 11, 12, 5, 2, 9, 13, 6, 3], (4, 2): [13, 10, 15, 12, 0, 6, 7, 11, 6, 16, 11, 14, 12, 11, 12, 3, 11, 1, 15, 3, 13, 15, 16, 1, 2, 13, 3, 15, 1, 4, 16, 3, 6, 7, 3, 16, 2, 13, 4, 0, 13, 0, 16, 7, 15, 8, 8, 4, 15, 1, 7, 13, 5, 12, 12, 8, 5, 8, 12, 10, 15, 13, 13, 2, 6, 7, 13, 16, 0, 16, 1, 14, 6, 13, 5, 10, 16, 10, 1, 5, 14, 5, 12, 16, 12, 10, 3, 2, 14, 3, 9, 6, 16, 12, 0, 5, 14, 16, 8, 12, 15, 1, 14, 14, 16, 8, 16, 5, 5, 9, 1, 12, 2, 3, 12, 5, 11, 11, 2, 6], (4, 5): [3, 8, 10, 11, 10, 11, 1, 7, 3, 0, 6, 7, 1, 16, 2, 1, 2, 1, 6, 4, 8, 14, 3, 11, 16, 14, 11, 15, 12, 3, 5, 15, 0, 2, 13, 1, 4, 13, 14, 3, 0, 7, 12, 15, 2, 4, 2, 1, 11, 4, 6, 13, 12, 5, 13, 5, 11, 7, 16, 12, 16, 14, 2, 8, 2, 7, 12, 14, 13, 16, 1, 4, 14, 5, 16, 12, 14, 2, 0, 16, 13, 5, 6, 5, 13, 7, 14, 12, 14, 11, 12, 13, 4, 15, 14, 5, 11, 4, 13, 7, 15, 12, 3, 2, 4, 10, 15, 3, 8, 12, 16, 12, 8, 1, 3, 2, 1, 3, 14, 9]}

    # Run on right
    else:
        p = parser.parse("rightlayout.json")
        t = parser.Traffic("righttraffic.json", "rightlayout.json")

        # 147
        pattern = {(1, 1): [16, 6, 8, 1, 9, 16, 8, 4, 10, 10, 10, 12, 4, 13, 9, 10, 14, 0, 5, 10]}

        # 0
        pattern2 = {(1, 1): [16, 2, 9, 9, 9, 9, 9, 9, 9, 9, 9, 9, 9, 9, 9, 9, 9, 9, 9, 9]}

    f = parser.Flow(p)
    light_min_time = 5

    s = Simulation(pattern, True)
    s.run()
    print(s.get_results())

    s2 = Simulation(pattern2, True)
    s2.run()
    print(s2.get_results())



#     # pattern = {}
#     # for i in [(1,1), (1,2), (3,1), (3,2)] :
#     #     pattern[i] = []
#     #     for q in range(int(400 / 5)) :
#     #         pattern[i].append(random.randint(0,16))
#
#
#     # pattern = {(1, 1): [1, 0, 9, 6, 14, 11, 10, 10, 9, 6, 15, 12, 15, 8, 13, 8, 5, 2, 4, 5, 15, 6, 11, 0, 10, 7, 7, 16, 15, 9, 3, 10, 5, 16, 2, 10, 10, 2, 4, 1, 13, 12, 6, 6, 14, 9, 4, 7, 1, 15, 12, 10, 15, 5, 7, 4, 6, 4, 11, 0, 15, 3, 10, 11, 16, 4, 3, 0, 8, 5, 16, 11, 8, 3, 2, 6, 1, 10, 8, 16], (1, 2): [8, 5, 14, 2, 8, 14, 15, 1, 6, 7, 15, 8, 2, 12, 10, 8, 7, 5, 14, 3, 13, 1, 6, 0, 4, 14, 12, 6, 9, 6, 13, 2, 5, 0, 2, 7, 10, 6, 16, 10, 1, 16, 14, 15, 13, 14, 4, 8, 10, 13, 3, 10, 7, 5, 6, 2, 5, 1, 2, 16, 16, 6, 7, 0, 10, 3, 2, 14, 2, 8, 0, 16, 10, 3, 5, 11, 2, 4, 10, 6], (3, 1): [15, 5, 3, 10, 8, 2, 4, 0, 5, 6, 12, 14, 13, 10, 14, 3, 5, 15, 10, 8, 2, 10, 14, 11, 5, 12, 4, 11, 12, 14, 3, 0, 1, 1, 7, 7, 2, 0, 3, 14, 11, 10, 7, 7, 0, 1, 5, 15, 0, 7, 16, 6, 16, 15, 14, 11, 3, 11, 16, 0, 0, 3, 13, 7, 14, 15, 12, 5, 15, 0, 8, 14, 1, 8, 10, 14, 1, 4, 7, 5], (3, 2): [4, 7, 4, 2, 3, 3, 10, 12, 4, 9, 9, 12, 3, 0, 13, 16, 1, 9, 14, 15, 5, 0, 12, 3, 4, 11, 4, 0, 12, 12, 14, 3, 16, 12, 13, 15, 2, 2, 14, 0, 4, 7, 3, 2, 4, 2, 6, 13, 15, 5, 8, 4, 13, 11, 15, 15, 5, 8, 9, 15, 7, 3, 15, 7, 3, 6, 11, 12, 16, 15, 7, 8, 3, 15, 2, 15, 4, 16, 8, 13]}
#     #
#     # pattern = {}
#     # for i in [(1,1), (1,2), (1,5), (3,1), (3,2), (3,5), (4,1), (4,2), (4,5)]:
#     #     pattern[i] = []
#     #     for q in range(int(600 / 5)) :
#     #         pattern[i].append(random.randint(0,16))
#
#     pattern = {(1, 1): [1, 16, 9, 5, 15, 2, 13, 1, 7, 16, 6, 13, 11, 10, 1, 7, 10, 14, 3, 4, 16, 10, 10, 5, 6, 1, 14, 11, 9, 11, 15, 7, 13, 7, 13, 15, 11, 6, 10, 15, 12, 5, 9, 15, 1, 2, 16, 15, 2, 10, 9, 12, 7, 12, 13, 0, 1, 7, 4, 3, 0, 7, 2, 1, 13, 15, 15, 11, 16, 13, 5, 8, 15, 12, 14, 12, 15, 15, 14, 7, 13, 0, 16, 10, 0, 13, 11, 12, 3, 15, 1, 16, 11, 12, 11, 10, 13, 7, 12, 8, 9, 13, 6, 11, 2, 5, 6, 6, 9, 4, 12, 5, 15, 11, 3, 0, 7, 11, 13, 0], (1, 2): [9, 14, 12, 9, 2, 9, 6, 15, 6, 15, 3, 13, 0, 11, 10, 9, 6, 11, 1, 1, 1, 4, 16, 10, 7, 11, 0, 12, 4, 11, 15, 15, 6, 8, 3, 6, 11, 6, 16, 2, 4, 9, 13, 1, 12, 1, 0, 13, 8, 11, 5, 2, 14, 3, 14, 10, 13, 5, 4, 2, 0, 11, 10, 10, 15, 4, 2, 1, 3, 14, 4, 10, 6, 9, 8, 13, 3, 11, 11, 9, 2, 6, 1, 3, 16, 0, 7, 10, 11, 0, 15, 4, 12, 13, 13, 14, 2, 3, 2, 11, 12, 11, 2, 4, 6, 14, 3, 14, 0, 9, 6, 16, 10, 5, 2, 8, 14, 3, 2, 3], (1, 5): [9, 3, 7, 12, 2, 5, 13, 1, 13, 12, 9, 4, 13, 2, 16, 3, 16, 14, 16, 8, 15, 7, 4, 2, 13, 16, 16, 9, 3, 5, 1, 11, 15, 0, 6, 15, 10, 10, 13, 5, 15, 2, 0, 13, 10, 10, 13, 8, 3, 9, 12, 3, 2, 8, 5, 15, 15, 5, 12, 2, 12, 7, 12, 6, 3, 2, 5, 3, 11, 10, 7, 0, 14, 15, 7, 10, 2, 13, 0, 6, 9, 9, 3, 15, 2, 4, 11, 6, 1, 7, 10, 9, 8, 16, 14, 2, 11, 15, 4, 12, 15, 9, 12, 7, 3, 14, 6, 3, 5, 4, 5, 1, 0, 6, 5, 8, 15, 11, 1, 4], (3, 1): [8, 9, 14, 2, 7, 6, 2, 15, 15, 13, 11, 9, 16, 0, 10, 16, 7, 3, 4, 10, 11, 0, 9, 0, 5, 3, 8, 2, 5, 8, 0, 5, 11, 0, 2, 14, 11, 12, 4, 7, 6, 1, 12, 1, 3, 7, 0, 9, 6, 13, 3, 5, 13, 16, 5, 7, 1, 0, 15, 2, 16, 2, 14, 16, 10, 14, 2, 6, 7, 11, 7, 4, 15, 3, 16, 13, 6, 15, 9, 6, 6, 6, 14, 0, 3, 1, 7, 3, 14, 15, 10, 15, 11, 4, 13, 7, 14, 10, 3, 14, 0, 14, 9, 14, 8, 8, 13, 2, 13, 4, 4, 16, 7, 1, 16, 1, 13, 14, 12, 3], (3, 2): [16, 15, 5, 14, 16, 0, 8, 3, 16, 12, 11, 10, 9, 4, 2, 2, 8, 10, 7, 5, 11, 15, 12, 8, 1, 11, 0, 6, 2, 5, 16, 4, 15, 3, 11, 10, 9, 8, 13, 5, 6, 0, 3, 12, 5, 6, 13, 5, 6, 6, 16, 13, 11, 7, 0, 8, 5, 9, 13, 15, 11, 4, 14, 16, 1, 1, 6, 1, 5, 7, 7, 3, 7, 5, 13, 2, 6, 7, 8, 3, 5, 8, 11, 1, 5, 2, 16, 16, 2, 10, 6, 10, 9, 0, 6, 7, 11, 0, 16, 14, 5, 13, 7, 8, 3, 7, 11, 0, 8, 9, 15, 0, 8, 10, 5, 8, 8, 5, 8, 14], (3, 5): [13, 5, 13, 3, 14, 9, 13, 11, 12, 4, 1, 14, 1, 6, 14, 4, 0, 15, 12, 8, 12, 2, 6, 13, 1, 0, 6, 12, 14, 2, 4, 8, 2, 2, 8, 12, 2, 8, 3, 8, 6, 10, 9, 4, 5, 12, 3, 9, 5, 9, 15, 11, 10, 4, 15, 14, 5, 1, 11, 7, 10, 10, 4, 10, 8, 4, 15, 6, 15, 12, 11, 10, 14, 5, 3, 3, 5, 9, 8, 12, 7, 11, 0, 15, 3, 5, 0, 11, 16, 15, 9, 7, 11, 3, 16, 10, 2, 8, 3, 0, 6, 7, 15, 8, 12, 0, 11, 4, 14, 1, 2, 16, 3, 6, 0, 3, 10, 9, 5, 13], (4, 1): [1, 1, 15, 8, 13, 10, 8, 4, 16, 1, 2, 10, 13, 7, 4, 15, 1, 13, 6, 3, 5, 0, 11, 6, 13, 7, 0, 7, 3, 11, 0, 6, 6, 12, 4, 3, 3, 0, 10, 13, 11, 5, 2, 1, 16, 1, 8, 4, 3, 16, 16, 6, 15, 12, 9, 15, 15, 9, 3, 15, 8, 3, 0, 14, 16, 16, 11, 13, 11, 1, 12, 14, 6, 11, 10, 3, 3, 15, 16, 4, 0, 4, 5, 3, 2, 15, 12, 2, 4, 7, 14, 15, 11, 12, 8, 7, 12, 7, 0, 12, 3, 15, 15, 16, 2, 3, 4, 16, 11, 14, 11, 12, 15, 13, 6, 2, 5, 9, 12, 13], (4, 2): [14, 3, 8, 3, 1, 1, 4, 3, 0, 15, 11, 4, 7, 16, 9, 16, 10, 2, 14, 4, 1, 16, 15, 14, 16, 4, 5, 3, 16, 6, 15, 8, 2, 4, 16, 7, 10, 5, 16, 13, 14, 0, 15, 15, 3, 9, 1, 0, 6, 4, 15, 12, 3, 4, 0, 16, 13, 15, 5, 15, 9, 12, 3, 9, 1, 3, 2, 14, 12, 3, 6, 11, 9, 7, 7, 3, 10, 16, 9, 10, 8, 15, 12, 4, 2, 12, 14, 7, 4, 10, 2, 2, 7, 5, 14, 5, 4, 8, 15, 1, 4, 8, 10, 15, 15, 15, 16, 10, 2, 13, 4, 12, 8, 2, 7, 5, 6, 6, 5, 8], (4, 5): [2, 8, 11, 0, 16, 15, 8, 0, 7, 0, 13, 12, 5, 15, 11, 7, 13, 4, 1, 0, 16, 2, 14, 5, 3, 9, 1, 6, 6, 12, 16, 2, 3, 13, 2, 14, 4, 1, 12, 8, 1, 12, 4, 5, 13, 11, 0, 12, 7, 4, 2, 4, 6, 10, 4, 2, 6, 6, 15, 2, 16, 4, 12, 15, 6, 6, 10, 12, 3, 2, 6, 9, 12, 8, 8, 7, 12, 0, 5, 1, 4, 2, 4, 6, 11, 12, 15, 6, 13, 10, 1, 14, 7, 0, 16, 9, 0, 3, 16, 13, 15, 11, 3, 14, 9, 7, 2, 1, 2, 10, 10, 12, 12, 12, 3, 13, 13, 10, 16, 15]}
#
#     s = Simulation(pattern, True)
#     s.run()
#     print(s.get_results())
#
# #
# # # to generate pattern from binary string, take mod 17 of 8-bit int from string
# # # pattern needs list of all intersections, and the range of time, and the light_min_time
# # #
